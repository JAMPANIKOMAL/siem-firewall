<!DOCTYPE html>
<html>
<head>
    <title>Python Firewall Dashboard</title>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: #0d1117;
            color: #f0f6fc;
            padding: 0;
            margin: 0;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 30px 20px;
            background: #161b22;
            border-radius: 16px;
            box-shadow: 0 4px 32px rgba(20, 20, 30, 0.25);
        }

        h1 {
            color: #58a6ff;
            margin-bottom: 32px;
            font-size: 2.2rem;
            text-align: center;
            letter-spacing: 1px;
        }

        .filter-form {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 28px;
            justify-content: center;
        }

        .filter-input,
        .filter-select,
        .filter-btn {
            padding: 10px 16px;
            border: 1px solid #30363d;
            border-radius: 8px;
            background-color: #161b22;
            color: #f0f6fc;
            font-size: 15px;
            outline: none;
        }

        .filter-btn {
            background-color: #238636;
            border: none;
            cursor: pointer;
            transition: background 0.2s ease;
            font-weight: bold;
        }

        .filter-btn:hover {
            background-color: #2ea043;
        }

        .charts-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 24px;
            margin-bottom: 36px;
        }

        .chart-box {
            flex: 1 1 220px;
            max-width: 260px;
            min-width: 220px;
            height: 220px;
            background-color: #161b22;
            padding: 16px;
            border-radius: 14px;
            box-shadow: 0 0 10px rgba(255,255,255,0.04);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .chart-title {
            color: #58a6ff;
            font-size: 1.1rem;
            margin-bottom: 8px;
            text-align: center;
            font-weight: 500;
        }

        table.dataTable {
            width: 100% !important;
            border-radius: 10px;
            overflow: hidden;
            background: #161b22;
        }

        table.dataTable thead th {
            background-color: #21262c;
            color: #ffffff;
            font-size: 15px;
            border-bottom: 2px solid #30363d;
        }

        table.dataTable tbody td {
            color: #c9d1d9;
            font-size: 14px;
        }

        .dataTables_filter {
            display: none !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            color: #f0f6fc !important;
            background: #161b22 !important;
            border: 1px solid #30363d !important;
            border-radius: 6px !important;
            margin: 0 2px;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background: #238636 !important;
            color: #fff !important;
        }
        .dataTables_wrapper .dataTables_info {
            color: #f0f6fc !important;
        }

        @media (max-width: 900px) {
            .charts-container {
                flex-direction: column;
                align-items: center;
            }
            .chart-box {
                max-width: 100%;
                width: 100%;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üî• Python Firewall Log Dashboard</h1>

    <form method="get" class="filter-form">
        <input type="text" name="query" placeholder="Search IP or Protocol" value="{{ query }}" class="filter-input">
        <select name="action" class="filter-select">
            <option value="">All</option>
            <option value="ALLOWED" {% if filter_action == 'ALLOWED' %}selected{% endif %}>ALLOWED</option>
            <option value="BLOCKED" {% if filter_action == 'BLOCKED' %}selected{% endif %}>BLOCKED</option>
        </select>
        <button type="submit" class="filter-btn">üîç Search</button>
    </form>

    <div class="charts-container">
        <div class="chart-box">
            <div class="chart-title">Protocol Distribution</div>
            <canvas id="protocolChart" width="200" height="200"></canvas>
        </div>
        <div class="chart-box">
            <div class="chart-title">Action Summary</div>
            <canvas id="actionChart" width="200" height="200"></canvas>
        </div>
        <div class="chart-box">
            <div class="chart-title">Top Source IPs</div>
            <canvas id="ipChart" width="200" height="200"></canvas>
        </div>
    </div>

    <table id="logTable" class="display">
        <thead>
            <tr>
                <th>ID</th>
                <th>Time</th>
                <th>Source IP</th>
                <th>Destination IP</th>
                <th>Protocol</th>
                <th>Action</th>
                <th>Reason</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>{{ log[0] }}</td>
                <td>{{ log[1] }}</td>
                <td>{{ log[2] }}</td>
                <td>{{ log[3] }}</td>
                <td>{{ log[4] }}</td>
                <td>{{ log[5] }}</td>
                <td>{{ log[6] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        $('#logTable').DataTable({
            pageLength: 25,
            order: [[0, "desc"]],
            language: {
                search: "",
                searchPlaceholder: "Search logs..."
            },
            createdRow: function(row, data, dataIndex) {
                $(row).css('background-color', '#161b22');
            }
        });
    });
</script>

<script>
    const protocolData = {
        labels: {{ protocols | map(attribute=0) | list | tojson | safe }},
        datasets: [{
            data: {{ protocols | map(attribute=1) | list | tojson | safe }},
            backgroundColor: ['#ff6384', '#36a2eb', '#ffce56', '#8e44ad', '#2ea043', '#d73a49']
        }]
    };

    const actionData = {
        labels: {{ actions | map(attribute=0) | list | tojson | safe }},
        datasets: [{
            data: {{ actions | map(attribute=1) | list | tojson | safe }},
            backgroundColor: ['#2ea043', '#d73a49']
        }]
    };

    const ipData = {
        labels: {{ top_ips | map(attribute=0) | list | tojson | safe }},
        datasets: [{
            label: 'Packets',
            data: {{ top_ips | map(attribute=1) | list | tojson | safe }},
            backgroundColor: '#58a6ff'
        }]
    };

    new Chart(document.getElementById('protocolChart').getContext('2d'), {
        type: 'pie',
        data: protocolData,
        options: {
            plugins: {
                legend: {
                    labels: { color: '#f0f6fc', font: { size: 13 } }
                }
            }
        }
    });

    new Chart(document.getElementById('actionChart').getContext('2d'), {
        type: 'doughnut',
        data: actionData,
        options: {
            plugins: {
                legend: {
                    labels: { color: '#f0f6fc', font: { size: 13 } }
                }
            }
        }
    });

    new Chart(document.getElementById('ipChart').getContext('2d'), {
        type: 'bar',
        data: ipData,
        options: {
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#f0f6fc', font: { size: 13 } },
                    grid: { color: '#30363d' }
                },
                x: {
                    ticks: { color: '#f0f6fc', font: { size: 13 } },
                    grid: { color: '#30363d' }
                }
            }
        }
    });
</script>

</body>
</html>